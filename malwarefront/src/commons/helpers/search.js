export let encodeSearchQuery = function(query) {
    // We need to escape this twice because of this bug: https://github.com/ReactTraining/history/issues/505
    return encodeURIComponent(encodeURIComponent(query))
}

export let decodeSearchQuery = function(query) {
    let pathname = decodeURIComponent(query);
    try {
        return decodeURIComponent(pathname);
    } catch (_error) {
        return pathname;
    }
}

export let escapeSearchValue = function(input) {
    if (typeof input === "string") {
        input = JSON.stringify(input)
    } else
    {
        input = String(input)
    }
    return input
}

export let makeSearchLink = function(field, input, noEscape, alternativeEndpoint){
    if (input === undefined)
        return "";

    let prefix = field + ":";

    if(!noEscape)
        input = escapeSearchValue(input);
    return `/${alternativeEndpoint || "search"}?q=`+encodeSearchQuery(prefix + input);
};

export let makeSearchConfigElementLink = function(element, value) {
    if(value !== undefined)
        return makeSearchLink("config.cfg", `*"${element}": ${escapeSearchValue(value)}*`)
    return makeSearchLink("config.cfg", `*${escapeSearchValue(element)}*`)
}

export let makeSearchRangeLink = function(field, from, to){
    return makeSearchLink(field, `[${escapeSearchValue(from)} TO ${escapeSearchValue(to)}]`, true)
}

export let makeSearchDateLink = function(field, date) {
    let addToDate = (d, ms) => new Date(new Date(d).valueOf() + ms)
    // Remove seconds, milliseconds, timezone from ISOString
    let strDate = d => d.toISOString().split(":").splice(0,2).join(":")
    return makeSearchRangeLink(
        field, 
        strDate(addToDate(date, -12*3600*1000)),
        strDate(addToDate(date, +12*3600*1000)))
}